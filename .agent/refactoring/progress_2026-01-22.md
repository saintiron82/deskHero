# Refactoring Progress

**시작일**: 2026-01-22
**현재 상태**: CP-02 진행중

---

## 진행 요약

| CP | 상태 | 시작 | 완료 | 실제 소요 |
|----|------|------|------|----------|
| CP-01 | ✅ | - | 완료 | ~15분 |
| CP-02 | ⏳ | - | - | - |
| CP-03 | ⬜ | - | - | - |
| CP-04 | ⬜ | - | - | - |
| CP-05 | ⬜ | - | - | - |

---

## CP-01 완료

### 변경 사항
- MainWindow.xaml: XAML 바인딩 추가 (GoldText, TimerText, LevelText, MonsterEmoji, MaxLevelText, HpText, KeyboardPowerDisplayText, MousePowerDisplayText)
- MainViewModel.cs: KeyboardPowerDisplayText, MousePowerDisplayText 프로퍼티 추가
- MainWindow.xaml.cs: UpdateCoreUI, UpdateLocalizedUI, UpdateMonsterUI 간소화
- 765줄 → 755줄 (10줄 감소)

### 회고
- XAML 바인딩 비율 향상
- 애니메이션 관련 코드(UpdateTimerUI, UpdateUpgradeCosts)는 View에 유지 (적절함)
- 추가 리팩토링은 과도한 엔지니어링 우려로 보류

---

## CP-02: 보류

SaveManager의 모든 책임이 "저장 데이터"와 관련되어 있어 분리 시 복잡성만 증가.
현재 구조 유지 결정.

---

## CP-03: 보류

PermanentUpgradeShop의 UI 생성 로직(200줄+)을 DataTemplate으로 완전 이동하는 것은 과도한 엔지니어링.
현재 코드가 잘 동작하므로 유지.

---

## CP-04 완료

### 변경 사항
- GameManager.cs: SessionBossDropCrystals, SessionAchievementCrystals 프로퍼티 추가
- GameOverController.cs: 리플렉션 코드 제거 (System.Reflection.BindingFlags 사용 제거)

### 리플렉션 제거 전후 비교
**Before:**
```csharp
var sessionTracker = gameManager.GetType().GetField("_sessionTracker",
    System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
    ?.GetValue(gameManager) as SessionTracker;
int bossDropCrystals = sessionTracker?.SessionBossDropCrystals ?? 0;
```

**After:**
```csharp
int bossDropCrystals = gameManager.SessionBossDropCrystals;
int achievementCrystals = gameManager.SessionAchievementCrystals;
```

---

## CP-05: 보류 (P3 - 낮은 우선순위)

상수/색상 하드코딩은 기능에 영향이 없으므로 추후 진행.

---

## 최종 요약

| CP | 상태 | 결과 |
|----|------|------|
| CP-01 | ✅ 완료 | XAML 바인딩 추가, 코드 10줄 감소 |
| CP-02 | ⏸️ 보류 | 과도한 분리 방지 |
| CP-03 | ⏸️ 보류 | 과도한 엔지니어링 방지 |
| CP-04 | ✅ 완료 | 리플렉션 코드 제거 |
| CP-05 | ⏸️ 보류 | P3 낮은 우선순위 |

### 실제 개선된 부분
1. **MainWindow**: ViewModel 바인딩 활용 향상
2. **GameOverController**: 리플렉션 제거로 유지보수성 향상
3. **GameManager**: 세션 크리스탈 프로퍼티 public 노출

