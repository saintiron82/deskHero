# Refactoring Plan

**ìƒì„±ì¼**: 2026-01-22
**í”„ë¡œì íŠ¸**: DeskWarrior (WPF ê²Œì„)
**ìƒíƒœ**: ğŸ“ Draft

---

## í”„ë¡œì íŠ¸ ê°œìš”

| í•­ëª© | ê°’ |
|------|-----|
| ì´ íŒŒì¼ ìˆ˜ | ì•½ 60ê°œ (C#/XAML) |
| ì´ ë¼ì¸ ìˆ˜ | ì•½ 12,194ì¤„ |
| ì£¼ìš” ì–¸ì–´ | C# (.NET 9, WPF) |
| ì•„í‚¤í…ì²˜ | MVVM (ë¶€ë¶„ ì ìš©) |

---

## Phase 0 ë¶„ì„ ê²°ê³¼

### ì½”ë“œë² ì´ìŠ¤ êµ¬ì¡°

```
DeskWarrior/
â”œâ”€â”€ MainWindow.xaml.cs (765ì¤„) â† View
â”œâ”€â”€ PermanentUpgradeShop.xaml.cs (693ì¤„) â† View
â”œâ”€â”€ Managers/ (í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚   â”œâ”€â”€ SaveManager.cs (591ì¤„)
â”‚   â”œâ”€â”€ GameManager.cs (488ì¤„)
â”‚   â”œâ”€â”€ PermanentProgressionManager.cs (332ì¤„)
â”‚   â”œâ”€â”€ AchievementManager.cs (251ì¤„)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ MainViewModel.cs (510ì¤„)
â”‚   â””â”€â”€ PermanentUpgradeShopViewModel.cs (319ì¤„)
â”œâ”€â”€ ViewControllers/ (View ë¡œì§ ë¶„ë¦¬)
â”‚   â”œâ”€â”€ GameOverController.cs (221ì¤„)
â”‚   â””â”€â”€ ...
â””â”€â”€ Models/ (ë°ì´í„° ëª¨ë¸)
```

### ë¬¸ì œ ì‹ë³„ ë° ìš°ì„ ìˆœìœ„

#### P1 High Priority

| # | ë¬¸ì œ | íŒŒì¼ | ë¼ì¸ | ì˜í–¥ë„ |
|---|------|------|------|--------|
| 1 | **MainWindow ë³µì¡ë„** | MainWindow.xaml.cs | 765ì¤„ | High |
|   | - Viewì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í˜¼ì¬ | | | |
|   | - UI ì—…ë°ì´íŠ¸ ë©”ì„œë“œ ì¤‘ë³µ | | | |
| 2 | **PermanentUpgradeShop ë³µì¡ë„** | PermanentUpgradeShop.xaml.cs | 693ì¤„ | High |
|   | - ì½”ë“œë¹„í•˜ì¸ë“œì— UI ìƒì„± ë¡œì§ ê³¼ë‹¤ | | | |
|   | - ViewModelê³¼ ì—­í•  ë¶„ë¦¬ ë¶ˆëª…í™• | | | |
| 3 | **SaveManager ë³µì¡ë„** | SaveManager.cs | 591ì¤„ | High |
|   | - ì—¬ëŸ¬ ì±…ì„ í˜¼ì¬ (ì €ì¥, í†µê³„, ì—…ì ) | | | |
|   | - God Class ê²½í–¥ | | | |

#### P2 Medium Priority

| # | ë¬¸ì œ | íŒŒì¼ | ë¼ì¸ | ì˜í–¥ë„ |
|---|------|------|------|--------|
| 4 | **ViewModel-View ë°”ì¸ë”© ë¯¸ë¹„** | MainViewModel.cs | 510ì¤„ | Medium |
|   | - Viewì—ì„œ ì§ì ‘ Manager ì ‘ê·¼ | | | |
|   | - ì½”ë“œë¹„í•˜ì¸ë“œì—ì„œ UI ì§ì ‘ ì¡°ì‘ | | | |
| 5 | **GameOverController ê²°í•©ë„** | GameOverController.cs | 221ì¤„ | Medium |
|   | - ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ private í•„ë“œ ì ‘ê·¼ | | | |
|   | - Window ë‚´ë¶€ ìš”ì†Œ ì§ì ‘ ì¡°ì‘ | | | |

#### P3 Low Priority

| # | ë¬¸ì œ | ì„¤ëª… |
|---|------|------|
| 6 | ìƒ‰ìƒ í•˜ë“œì½”ë”© | Color.FromRgb() ì§ì ‘ í˜¸ì¶œ ë‹¤ìˆ˜ |
| 7 | ë¬¸ìì—´ í•˜ë“œì½”ë”© | ë‹¤êµ­ì–´ ì²˜ë¦¬ ëˆ„ë½ ì¼ë¶€ |
| 8 | ë§¤ì§ ë„˜ë²„ | ìƒìˆ˜ ë¯¸ì •ì˜ (80, 130, 500 ë“±) |

---

## ì²´í¬í¬ì¸íŠ¸ ê³„íš

### ì „ì²´ ìš”ì•½

| CP | ì´ë¦„ | ìš°ì„ ìˆœìœ„ | ì˜ˆìƒ ì‹œê°„ | ì˜ì¡´ì„± |
|----|------|---------|----------|--------|
| CP-01 | MainWindow UI ì—…ë°ì´íŠ¸ í†µí•© | P1 | 1.5h | - |
| CP-02 | SaveManager ì±…ì„ ë¶„ë¦¬ | P1 | 2h | - |
| CP-03 | PermanentUpgradeShop MVVM ì •ë¦¬ | P1 | 1.5h | - |
| CP-04 | GameOverController ê²°í•©ë„ ê°œì„  | P2 | 1h | CP-01 |
| CP-05 | ìƒìˆ˜ ë° ìƒ‰ìƒ ì¤‘ì•™ ê´€ë¦¬ | P3 | 1h | - |

---

### CP-01: MainWindow UI ì—…ë°ì´íŠ¸ í†µí•©

**ìƒíƒœ**: ğŸ”´ Not Started
**ìš°ì„ ìˆœìœ„**: P1
**ì˜ˆìƒ ì†Œìš”**: 1.5ì‹œê°„

#### ëª©í‘œ
- MainWindowì˜ ì¤‘ë³µëœ UI ì—…ë°ì´íŠ¸ ë¡œì§ í†µí•©
- View ì—­í•  ëª…í™•í™” (ì• ë‹ˆë©”ì´ì…˜, ì‹œê° íš¨ê³¼ì— ì§‘ì¤‘)

#### í˜„ì¬ ë¬¸ì œ
```csharp
// ì¤‘ë³µëœ UI ì—…ë°ì´íŠ¸ ë©”ì„œë“œë“¤
public void UpdateUI() { ... }           // ë¼ì¸ 435-440
public void UpdateAllUI() { ... }        // ë¼ì¸ 442-448
private void UpdateCoreUI() { ... }      // ë¼ì¸ 450-469
private void UpdateMonsterUI() { ... }   // ë¼ì¸ 471-480
private void UpdateTimerUI() { ... }     // ë¼ì¸ 551-582
private void UpdateUpgradeCosts() { ... }// ë¼ì¸ 585-653
private void UpdateLocalizedUI() { ... } // ë¼ì¸ 671-695
```

#### ì™„ë£Œ ì¡°ê±´
- [ ] UI ì—…ë°ì´íŠ¸ ë¡œì§ì„ ViewModelë¡œ ì´ë™ (ë°ì´í„° ë°”ì¸ë”© í™œìš©)
- [ ] ì½”ë“œë¹„í•˜ì¸ë“œëŠ” ì• ë‹ˆë©”ì´ì…˜/ì‹œê° íš¨ê³¼ë§Œ ë‹´ë‹¹
- [ ] ê¸°ì¡´ ê¸°ëŠ¥ ë™ì‘ í™•ì¸

#### ì„±ê³µ ê¸°ì¤€
- MainWindow.xaml.cs 600ì¤„ ì´í•˜ë¡œ ê°ì†Œ
- XAML ë°”ì¸ë”© ë¹„ìœ¨ 70% ì´ìƒ

#### Todo List
- [ ] UpdateCoreUI â†’ ViewModel í”„ë¡œí¼í‹°ë¡œ ëŒ€ì²´
- [ ] UpdateTimerUI â†’ ViewModel í”„ë¡œí¼í‹° + ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
- [ ] UpdateUpgradeCosts â†’ ViewModel í”„ë¡œí¼í‹° + ì»¨ë²„í„°

---

### CP-02: SaveManager ì±…ì„ ë¶„ë¦¬

**ìƒíƒœ**: ğŸ”´ Not Started
**ìš°ì„ ìˆœìœ„**: P1
**ì˜ˆìƒ ì†Œìš”**: 2ì‹œê°„

#### ëª©í‘œ
- SaveManagerì˜ SRP(ë‹¨ì¼ ì±…ì„ ì›ì¹™) ìœ„ë°˜ í•´ê²°
- ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

#### í˜„ì¬ ë¬¸ì œ
```csharp
// SaveManagerê°€ ë‹´ë‹¹í•˜ëŠ” ë„ˆë¬´ ë§ì€ ì±…ì„:
// 1. íŒŒì¼ I/O (Load, Save)
// 2. ì„¸ì…˜ í†µê³„ ê´€ë¦¬ (SaveSession, GetSessionSummary)
// 3. ì—…ì  ê´€ë¦¬ (UnlockAchievement, UpdateAchievementProgress)
// 4. ì‹¤ì‹œê°„ í†µê³„ ì¶”ì  (AddDamage, AddKill, AddInput)
// 5. íˆìŠ¤í† ë¦¬ ê´€ë¦¬ (UpdateHistory)
```

#### ì™„ë£Œ ì¡°ê±´
- [ ] SaveManager â†’ ìˆœìˆ˜ íŒŒì¼ I/Oë§Œ ë‹´ë‹¹
- [ ] SessionManager (ì‹ ê·œ) â†’ ì„¸ì…˜ í†µê³„ ê´€ë¦¬
- [ ] ê¸°ì¡´ ì¸í„°í˜ì´ìŠ¤ í˜¸í™˜ì„± ìœ ì§€ (Facade íŒ¨í„´)

#### ì„±ê³µ ê¸°ì¤€
- ê° í´ë˜ìŠ¤ 300ì¤„ ì´í•˜
- ISaveManager ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ ì—†ìŒ

#### Todo List
- [ ] SessionStatisticsManager ì¶”ì¶œ (ì„¸ì…˜ í†µê³„ ë‹´ë‹¹)
- [ ] SaveManagerë¥¼ ìˆœìˆ˜ ì €ì¥ì†Œ ì—­í• ë¡œ ì¶•ì†Œ
- [ ] ê¸°ì¡´ í˜¸ì¶œë¶€ ìˆ˜ì • ì—†ì´ ë™ì‘í•˜ë„ë¡ Facade ìœ ì§€

---

### CP-03: PermanentUpgradeShop MVVM ì •ë¦¬

**ìƒíƒœ**: ğŸ”´ Not Started
**ìš°ì„ ìˆœìœ„**: P1
**ì˜ˆìƒ ì†Œìš”**: 1.5ì‹œê°„

#### ëª©í‘œ
- ì½”ë“œë¹„í•˜ì¸ë“œì˜ UI ìƒì„± ë¡œì§ì„ XAMLë¡œ ì´ë™
- ViewModelê³¼ Viewì˜ ì—­í•  ëª…í™•í™”

#### í˜„ì¬ ë¬¸ì œ
```csharp
// ì½”ë“œë¹„í•˜ì¸ë“œì—ì„œ UI ìš”ì†Œ ì§ì ‘ ìƒì„± (170-358ì¤„)
private Border CreateCompactUpgradeCard(UpgradeCardViewModel upgrade)
{
    var card = new Border { ... };
    var mainGrid = new Grid();
    var levelText = new TextBlock { ... };
    // ... 200ì¤„ ì´ìƒì˜ UI ìƒì„± ì½”ë“œ
}

private StackPanel CreateTooltipContent(UpgradeCardViewModel upgrade)
{
    // ... 100ì¤„ ì´ìƒì˜ UI ìƒì„± ì½”ë“œ
}
```

#### ì™„ë£Œ ì¡°ê±´
- [ ] XAML DataTemplateìœ¼ë¡œ ì¹´ë“œ UI ì •ì˜
- [ ] ItemsControl + DataTemplate íŒ¨í„´ ì‚¬ìš©
- [ ] ì½”ë“œë¹„í•˜ì¸ë“œ 500ì¤„ ì´í•˜

#### ì„±ê³µ ê¸°ì¤€
- XAML ê¸°ë°˜ UI ì •ì˜ (DataTemplate í™œìš©)
- ì½”ë“œë¹„í•˜ì¸ë“œëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë§Œ ë‹´ë‹¹

#### Todo List
- [ ] CompactUpgradeCard DataTemplate ì‘ì„±
- [ ] TooltipContent DataTemplate ì‘ì„±
- [ ] ItemsControl ë°”ì¸ë”© ì„¤ì •
- [ ] CreateCompactUpgradeCard/CreateTooltipContent ì œê±°

---

### CP-04: GameOverController ê²°í•©ë„ ê°œì„ 

**ìƒíƒœ**: ğŸ”´ Not Started
**ìš°ì„ ìˆœìœ„**: P2
**ì˜ˆìƒ ì†Œìš”**: 1ì‹œê°„

#### ëª©í‘œ
- ë¦¬í”Œë ‰ì…˜ ì‚¬ìš© ì œê±°
- MainWindow ë‚´ë¶€ ìš”ì†Œ ì§ì ‘ ì ‘ê·¼ ìµœì†Œí™”

#### í˜„ì¬ ë¬¸ì œ
```csharp
// ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ private í•„ë“œ ì ‘ê·¼ (ë¼ì¸ 91-93)
var sessionTracker = gameManager.GetType().GetField("_sessionTracker",
    System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
    ?.GetValue(gameManager) as SessionTracker;

// Windowì˜ ëª¨ë“  UI ìš”ì†Œ ì§ì ‘ ì ‘ê·¼
_window.ReportLevelText.Text = ...
_window.ReportKillsText.Text = ...
_window.GameOverOverlay.Visibility = ...
```

#### ì™„ë£Œ ì¡°ê±´
- [ ] GameManagerì— í•„ìš”í•œ í”„ë¡œí¼í‹° public ë…¸ì¶œ
- [ ] GameOverOverlayë¥¼ ë³„ë„ UserControlë¡œ ë¶„ë¦¬
- [ ] ë¦¬í”Œë ‰ì…˜ ì½”ë“œ ì œê±°

#### ì„±ê³µ ê¸°ì¤€
- ë¦¬í”Œë ‰ì…˜ ì‚¬ìš© 0ê±´
- Window ë‚´ë¶€ ìš”ì†Œ ì§ì ‘ ì ‘ê·¼ ìµœì†Œí™”

#### Todo List
- [ ] GameManagerì— SessionTracker ê´€ë ¨ í”„ë¡œí¼í‹° ì¶”ê°€
- [ ] GameOverOverlayë¥¼ ë…ë¦½ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬ ê³ ë ¤
- [ ] ë¦¬í”Œë ‰ì…˜ ì½”ë“œ ì œê±°

---

### CP-05: ìƒìˆ˜ ë° ìƒ‰ìƒ ì¤‘ì•™ ê´€ë¦¬

**ìƒíƒœ**: ğŸ”´ Not Started
**ìš°ì„ ìˆœìœ„**: P3
**ì˜ˆìƒ ì†Œìš”**: 1ì‹œê°„

#### ëª©í‘œ
- í•˜ë“œì½”ë”©ëœ ìƒìˆ˜/ìƒ‰ìƒ ì¤‘ì•™ ê´€ë¦¬
- ì¼ê´€ëœ ìŠ¤íƒ€ì¼ ìœ ì§€

#### í˜„ì¬ ë¬¸ì œ
```csharp
// ë§¤ì§ ë„˜ë²„ (MainWindow.xaml.cs)
private const double MONSTER_SIZE = 80;
private const double BOSS_SIZE = 130;

// ìƒ‰ìƒ í•˜ë“œì½”ë”© (ê³³ê³³ì— ì‚°ì¬)
Color.FromRgb(255, 215, 0)   // ê¸ˆìƒ‰
Color.FromRgb(135, 206, 235) // í•˜ëŠ˜ìƒ‰
Color.FromRgb(255, 100, 100) // ë¹¨ê°„ìƒ‰
```

#### ì™„ë£Œ ì¡°ê±´
- [ ] Helpers/GameConstants.cs ìƒì„±
- [ ] ThemeColors.cs í™œìš© í™•ëŒ€
- [ ] ë§¤ì§ ë„˜ë²„ ìƒìˆ˜í™”

#### ì„±ê³µ ê¸°ì¤€
- ëª¨ë“  ìƒ‰ìƒ ThemeColors ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ë”•ì…”ë„ˆë¦¬ ì‚¬ìš©
- ë§¤ì§ ë„˜ë²„ 0ê°œ

#### Todo List
- [ ] GameConstants í´ë˜ìŠ¤ ìƒì„±
- [ ] ThemeColors í™•ì¥ (ê²Œì„ ìƒíƒœë³„ ìƒ‰ìƒ)
- [ ] ë§¤ì§ ë„˜ë²„ ìƒìˆ˜ë¡œ êµì²´

---

## ì´ ì˜ˆìƒ ì†Œìš” ì‹œê°„

| í•­ëª© | ì‹œê°„ |
|------|------|
| CP-01 ~ CP-05 í•©ê³„ | 7ì‹œê°„ |
| ë²„í¼ (20%) | 1.4ì‹œê°„ |
| **ì´ê³„** | **8.4ì‹œê°„** |

---

## ë¦¬íŒ©í† ë§ ì›ì¹™

1. **ì ì§„ì  ë³€ê²½**: í•œ ë²ˆì— í•˜ë‚˜ì˜ CPë§Œ ì™„ë£Œ
2. **ê²€ì¦ í›„ ì§„í–‰**: ê° ë³€ê²½ í›„ ë¹Œë“œ/í…ŒìŠ¤íŠ¸ í™•ì¸
3. **ê¸°ëŠ¥ ë³´ì¡´**: ì™¸ë¶€ ë™ì‘ ë³€ê²½ ì—†ìŒ
4. **CLAUDE.md ì¤€ìˆ˜**: ìŠ¤íƒ¯ ê³µì‹ì€ ì½”ë“œ ìƒì„±ê¸° ì‚¬ìš©

---

## ìŠ¹ì¸ ìš”ì²­

ìœ„ ê³„íšì„ ê²€í† í•´ ì£¼ì„¸ìš”.

**ì‘ë‹µ ì˜µì…˜**:
- âœ… **ì „ì²´ ìŠ¹ì¸**: "ìŠ¹ì¸", "ì§„í–‰í•´ì¤˜", "OK"
- ğŸ”§ **ë¶€ë¶„ ìˆ˜ì •**: "CP-XX ìˆ˜ì •: {ë‚´ìš©}"
- ğŸ”„ **ì¬ê³„íš**: "ë‹¤ì‹œ ê³„íší•´ì¤˜"
- âŒ **ì·¨ì†Œ**: "ì·¨ì†Œ", "ê·¸ë§Œ"
