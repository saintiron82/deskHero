# DeskWarrior 밸런스 설계서

## 문서 정보
- 버전: v1.0
- 작성일: 2026-01-16
- 작성자: jina (Game Design AI)
- 목적: 데이터 기반 밸런스 목표 및 검증 시나리오 정의

---

## 1. 밸런스 철학

### 1.1 핵심 원칙

#### 즉각적 성장 체감 (0-10회 플레이)
- **신규 유저 진입장벽 최소화**: 초반 5분 내에 첫 성장 경험 제공
- **플레이당 최소 1개 영구 업그레이드 보장** (크리스탈 획득)
- **1회 플레이당 10-15분** 목표 세션 시간

#### 중장기 성장 곡선 (10-50회 플레이)
- **선형 성장 구간 (1-10회)**: 매 플레이마다 눈에 띄는 진전
- **소프트캡 진입 (10-30회)**: 전략적 선택 중요성 증대
- **하드캡 도달 (50회+)**: 최적화 플레이 요구

#### 의미 있는 선택 제공
- **인게임 스탯**: 단일 세션 내 전략 (공격 vs 경제 vs 시간)
- **영구 스탯**: 장기 빌드 방향성 (화력 vs 성장 vs 유틸리티)

---

## 2. 플레이 진행도 예측

### 2.1 1회 플레이 (초심자)

#### 예상 시나리오
```
세션 시간: 10-15분
도달 레벨: 15-20
획득 골드: 약 500-800
획득 크리스탈: 10-20 (보스 1-2 처치)
```

#### 인게임 성장 예상
| 스탯 | 예상 레벨 | 투입 골드 | 효과 |
|------|----------|----------|------|
| keyboard_power | 3-5 | ~800 | +3-5 데미지 |
| mouse_power | 3-5 | ~800 | +3-5 데미지 |
| gold_flat | 1-2 | ~150 | +5-10 골드 |
| time_thief | 0-1 | 0 or 300 | +0.5초 (선택) |

#### 영구 스탯 투자
- **추천**: `base_attack` Lv1-2 (~300 크리스탈)
- **대안**: `gold_multi_perm` Lv1 (40 크리스탈) + `start_gold` Lv1-2 (~120 크리스탈)

#### 체감 목표
- "다음 판에서는 더 빨리 진행할 수 있겠다"
- "어떤 스탯을 먼저 올릴지 선택할 수 있다"

---

### 2.2 10회 플레이 (숙련 진입)

#### 예상 시나리오
```
누적 세션: 10회
평균 도달 레벨: 30-40
누적 크리스탈: ~500-800
영구 스탯 평균 레벨: 5-10 (주력 스탯 기준)
```

#### 영구 스탯 분포 예측
| 스탯 | 예상 레벨 | 누적 비용 | 효과 |
|------|----------|----------|------|
| base_attack | 10 | 283 | +10 기본 데미지 |
| attack_percent | 5 | 679 | +25% 배율 |
| gold_multi_perm | 10 | 2,259 | +30% 골드 |
| start_gold | 5 | 244 | +250 골드 시작 |

**총 투자 크리스탈**: ~3,465

#### 인게임 플레이 변화
- 레벨 10 도달 시간: 15분 → 8분으로 단축
- 초반 업그레이드 스킵 가능 (시작 스탯으로 커버)
- 콤보 시스템 활용 시작

#### 체감 목표
- "빌드 전략이 분명해졌다"
- "시작부터 강하다는 느낌"
- "특정 플레이스타일 확립" (화력형/경제형/하이브리드)

---

### 2.3 50회 플레이 (마스터)

#### 예상 시나리오
```
누적 세션: 50회
최대 도달 레벨: 80-100+
누적 크리스탈: ~3,000-5,000
주력 스탯 Lv30+ 도달
```

#### 영구 스탯 최적화 빌드
| 스탯 | 권장 레벨 | 누적 비용 | 효과 |
|------|----------|----------|------|
| base_attack | 30 | 2,183 | +30 기본 데미지 |
| attack_percent | 30 | 26,312 | +150% 배율 |
| gold_multi_perm | 30 | 28,864 | +90% 골드 |
| crit_chance | 30 | 258,903 | +30% 크리티컬 |
| start_level | 10 | 3,465 | 레벨 10 시작 |

**총 투자 크리스탈**: ~319,727 (주력 5종 기준)

#### 하드캡 스탯
- `combo_flex`: Lv20 MAX (15,039)
- `time_extend`: Lv24 MAX (709,626) - 엔드게임
- `crit_damage`: Lv30 MAX (711,140)
- `multi_hit`: Lv30 MAX (853,368)

#### 체감 목표
- "완벽한 빌드 완성"
- "세부 최적화 단계"
- "신기록 도전"

---

## 3. 경제 밸런스

### 3.1 골드 경제 (인게임)

#### 골드 획득 모델
```python
# 몬스터 기본 골드
base_gold = 10 + (monster_level * 2)

# 플레이어 보너스 적용
flat_bonus = gold_flat + gold_flat_perm
multi_bonus = 1 + (gold_multi + gold_multi_perm) / 100

final_gold = (base_gold + flat_bonus) * multi_bonus
```

#### 레벨별 골드 획득 예측
| 레벨 | 기본 골드 | +보너스 (Flat+20) | x보너스 (×1.5) | 최종 골드 |
|------|----------|-------------------|---------------|----------|
| 5 | 20 | 40 | 60 | 60 |
| 10 | 30 | 50 | 75 | 75 |
| 20 | 50 | 70 | 105 | 105 |
| 50 | 110 | 130 | 195 | 195 |

**레벨 1-50 누적 골드**: 약 3,000-5,000 골드 (보너스 없이)
**보너스 적용 시**: 10,000-20,000 골드

#### 골드 소비 분포
| 스탯 | Lv10 비용 | Lv30 비용 | 우선순위 |
|------|----------|----------|---------|
| keyboard_power | 4,924 | 61,148 | 1순위 (화력) |
| mouse_power | 4,924 | 61,148 | 1순위 (화력) |
| gold_flat | 9,640 | 162,587 | 2순위 (경제) |
| gold_multi | 20,461 | 765,447 | 3순위 (경제) |
| combo_damage | 44,697 | 2,524,384 | 4순위 (고급) |
| time_thief | 52,892 | 3,613,730 | 5순위 (고급) |
| combo_flex | 31,092 | MAX | 특수 |

#### 인플레이션 방지 메커니즘
1. **세션 리셋**: 골드는 세션 종료 시 초기화 (무한 축적 방지)
2. **지수 성장 비용**: 레벨 30+ 부터 급격한 비용 증가
3. **소프트캡**: 특정 스탯은 MAX 레벨 설정 (combo_flex Lv20)
4. **타임어택**: 제한 시간으로 무한 성장 불가

---

### 3.2 크리스탈 경제 (영구)

#### 크리스탈 획득 경로
| 획득 방법 | 크리스탈량 | 빈도 | 비고 |
|----------|----------|------|------|
| 보스 드롭 (기본) | 10-20 | 10레벨마다 | 주 수입원 |
| 보스 드롭 (crystal_flat) | +1-20 | Lv별 | 영구 스탯 의존 |
| 골드 변환 (1000:1) | 1 per 1000G | 수동 | 서브 수입원 |
| 업적 보상 | 50-500 | 일회성 | 마일스톤 |

#### 세션당 크리스탈 획득 예측
| 플레이 횟수 | 도달 레벨 | 보스 처치 | 획득 크리스탈 | 누적 |
|------------|----------|----------|-------------|------|
| 1회 | 15-20 | 1-2 | 10-40 | 10-40 |
| 10회 | 30-40 | 3-4 | 30-80 | 300-800 |
| 50회 | 80-100 | 8-10 | 80-200 | 4,000-10,000 |

#### 크리스탈 소비 우선순위
##### 화력 빌드 (DPS 극대화)
```
1순위: base_attack Lv10 (283)
2순위: attack_percent Lv10 (2,346)
3순위: crit_chance Lv10 (8,358)
4순위: crit_damage Lv10 (15,039)
누적: ~26,000 크리스탈
```

##### 경제 빌드 (성장 가속)
```
1순위: gold_multi_perm Lv10 (2,259)
2순위: start_gold Lv10 (838)
3순위: gold_flat_perm Lv10 (713)
4순위: start_level Lv5 (1,566)
누적: ~5,400 크리스탈
```

##### 하이브리드 빌드 (균형)
```
base_attack Lv10 + gold_multi_perm Lv10 + start_gold Lv5
= 283 + 2,259 + 244 = 2,786 크리스탈
```

#### 인플레이션 방지 메커니즘
1. **획득 제한**: 보스 처치 기반 (시간당 한계 존재)
2. **하드캡**: 일부 스탯 MAX 레벨 (크리스탈 투자 상한)
3. **소프트캡 강화**: 고급 스탯(crit, multi_hit)은 기하급수 비용
4. **전략적 선택 강제**: 모든 스탯 만렙 불가능하게 설계

---

### 3.3 경제 균형 검증 공식

#### 단위 시간당 효율 (GPM: Gold Per Minute)
```python
# 이상적인 GPM
ideal_gpm = 100-200 골드/분

# 측정 방법
gpm = total_gold_earned / session_time_minutes

# 벨런스 체크
if gpm < 100: "너무 어려움"
if gpm > 300: "너무 쉬움"
```

#### 크리스탈 투자 회수 기간 (ROI)
```python
# 예: gold_multi_perm Lv1 (+3% 골드)
cost = 40 크리스탈
benefit_per_session = session_gold * 0.03

# 회수 기간
roi_sessions = cost / (benefit_per_session / crystal_per_session)

# 목표: ROI < 5 세션
```

---

## 4. 콤보 시스템 상세

### 4.1 콤보 발동 메커니즘

#### 리듬 감지 알고리즘
```python
# 입력 간격 측정
time_between_inputs = current_input_time - last_input_time

# 리듬 허용 오차
base_tolerance = 0.01  # 10ms 기본
bonus_tolerance = combo_flex * 0.005  # Lv1당 +5ms

total_tolerance = base_tolerance + bonus_tolerance

# 리듬 판정
if abs(time_between_inputs - expected_rhythm) <= total_tolerance:
    combo_activated = True
```

#### 허용 오차 레벨별 정량화
| combo_flex Lv | 효과 (초) | 누적 허용 오차 | 체감 |
|--------------|----------|---------------|------|
| 0 (기본) | +0.000 | ±0.010초 | 매우 어려움 |
| 5 | +0.025 | ±0.035초 | 어려움 |
| 10 | +0.050 | ±0.060초 | 보통 |
| 15 | +0.075 | ±0.085초 | 쉬움 |
| 20 (MAX) | +0.100 | ±0.110초 | 매우 쉬움 |

**설계 의도**: 초보자는 낮은 레벨에서도 가능하되, 숙련자는 MAX 레벨로 안정화

---

### 4.2 콤보 스택 및 배율

#### 스택 누적 시스템
```
스택 0 (기본): ×1 데미지
스택 1 (리듬 발동): ×2 데미지
스택 2 (3초 내 재발동): ×4 데미지
스택 3 (3초 내 재발동): ×8 데미지 (MAX)
```

#### 콤보 데미지 보너스 적용
```python
# 최종 콤보 배율
base_multiplier = [1, 2, 4, 8][combo_stack]
bonus_multiplier = 1 + (combo_damage / 100)

final_multiplier = base_multiplier * bonus_multiplier

# 예: combo_damage Lv10 (+100%) + Stack 3
# = 8 × 2.0 = ×16 데미지
```

#### 레벨별 콤보 데미지 배율표
| combo_damage Lv | 효과 (%) | Stack 1 | Stack 2 | Stack 3 |
|----------------|---------|---------|---------|---------|
| 0 | +0% | ×2 | ×4 | ×8 |
| 10 | +100% | ×4 | ×8 | ×16 |
| 20 | +200% | ×6 | ×12 | ×24 |
| 30 | +300% | ×8 | ×16 | ×32 |

---

### 4.3 콤보 밸런스 고려사항

#### 리스크-리워드 설계
| 요소 | 난이도 | 보상 | 밸런스 |
|------|--------|------|--------|
| 리듬 유지 | 높음 (정확한 타이밍) | Stack 3 → ×8-32 | 고난도 고보상 |
| combo_flex 투자 | 중간 (골드 소모) | 안정성 ↑ | 비용 대비 체감 |
| combo_damage 투자 | 높음 (비싼 비용) | 배율 폭증 | 후반 특화 |

#### 밸런스 위험 요소
1. **콤보 데미지 과다**: Lv30+ 시 ×32 배율 → 난이도 붕괴
   - **대응**: 비용 지수 증가 (Lv30 = 2.5M 골드)

2. **콤보 유연성 과다**: ±0.11초 허용 → 리듬 게임성 상실
   - **대응**: Lv20 하드캡

3. **스택 무한 유지**: 3초 타이머 + 실수 허용 → 영구 ×8
   - **대응**: 몬스터 HP 증가 속도로 자연스러운 해제 유도

#### 테스트 필수 항목
- [ ] 콤보 없이도 클리어 가능 (비숙련 유저)
- [ ] 콤보 활용 시 2배 이상 효율 (숙련 유저 보상)
- [ ] combo_flex Lv10 = 60% 이상 발동 성공률
- [ ] combo_damage Lv20 이하로 Lv50 클리어 가능

---

## 5. 테스트 시나리오

### 5.1 초보자 경험 테스트

#### TC-001: 첫 플레이 (10분)
```
사전 조건:
- 모든 영구 스탯 Lv0
- 튜토리얼 완료

테스트 목표:
- 레벨 15 도달 가능 여부
- 크리스탈 10개 이상 획득
- 최소 1개 영구 스탯 업그레이드 가능

검증 방법:
1. 자동 플레이 봇 실행 (무작위 입력)
2. 10분 타이머 설정
3. 도달 레벨, 획득 크리스탈 기록

합격 기준:
- 레벨 10 이상
- 크리스탈 5 이상
- 골드 300 이상
```

#### TC-002: 5회 반복 플레이 (누적 효과)
```
사전 조건:
- 영구 스탯: base_attack Lv3, start_gold Lv2

테스트 목표:
- 성장 체감 검증
- 5회차에서 레벨 30 도달 가능 여부

검증 방법:
1. 각 세션마다 도달 레벨, 시간 기록
2. 회차별 진전도 그래프 생성
3. 체감 성장 곡선 확인

합격 기준:
- 1회차 대비 5회차 도달 레벨 +50% 이상
- 5회차 평균 세션 시간 12-15분
```

---

### 5.2 밸런스 검증 테스트

#### TC-010: 골드 경제 균형
```
테스트 목표:
- 레벨별 골드 획득량과 업그레이드 비용 균형 검증

시나리오:
레벨 20 도달 시
- 획득 골드: ~1,500-2,000
- 가능 업그레이드:
  - keyboard_power Lv5 (350)
  - mouse_power Lv5 (350)
  - gold_flat Lv3 (630)
  - 잔여 골드: 200-700

검증 방법:
dotnet run --project DeskWarrior.Simulator -- --target 20 --runs 1000

합격 기준:
- 주력 스탯 2종 Lv5 이상 달성
- 경제 스탯 최소 1종 투자 가능
- 잔여 골드 0-30% 범위
```

#### TC-011: 크리스탈 경제 균형
```
테스트 목표:
- 50회 플레이 후 영구 스탯 분포 검증

시나리오:
50회 플레이 후 누적 크리스탈: ~5,000
- 화력 빌드 완성 불가 (필요: 26,000)
- 경제 빌드 완성 가능 (필요: 5,400)
- 하이브리드 빌드 1회 가능

검증 방법:
dotnet run --project DeskWarrior.Simulator -- --progress --target 100 --strategy balanced

합격 기준:
- 특정 빌드 완성 가능 (경제 또는 하이브리드)
- 모든 빌드 동시 완성 불가
- 추가 50회 시 화력 빌드 전환 가능
```

---

### 5.3 콤보 시스템 테스트

#### TC-020: 콤보 발동률 (combo_flex Lv0)
```
테스트 목표:
- 기본 허용 오차(±10ms)에서의 발동 성공률

시나리오:
- 숙련 플레이어 기준 (평균 ±50ms 오차)
- 100회 리듬 입력 시도

검증 방법:
1. 입력 타이밍 로그 기록
2. 리듬 판정 성공/실패 집계
3. 성공률 계산

합격 기준:
- 숙련 플레이어 성공률: 20-30% (높은 난이도)
- 일반 플레이어 성공률: 5-10%
```

#### TC-021: 콤보 발동률 (combo_flex Lv10)
```
테스트 목표:
- 중간 레벨 허용 오차(±60ms)에서의 발동 성공률

검증 방법:
(TC-020과 동일)

합격 기준:
- 숙련 플레이어 성공률: 70-80%
- 일반 플레이어 성공률: 40-50%
```

#### TC-022: 콤보 데미지 상한 검증
```
테스트 목표:
- combo_damage MAX 레벨에서 데미지 밸런스 확인

시나리오:
- combo_damage Lv30 (비용: 2.5M 골드)
- Stack 3 유지 (×32 배율)
- 레벨 50 몬스터 HP

검증 방법:
1. 콤보 데미지 계산
   - base: 10, attack: +30, attack%: +150%
   - = 10 + 30 = 40 × 2.5 = 100
   - × Stack 3 (×8) × combo_damage (+300% = ×4)
   - = 100 × 8 × 4 = 3,200 데미지/타

2. 레벨 50 몬스터 HP: ~10,000-20,000
3. 처치 시간 계산

합격 기준:
- 보스 처치: 10초 이상 (즉사 방지)
- 일반 몬스터: 2-3타 처치 (과도한 난이도 X)
```

---

### 5.4 극한 상황 테스트

#### TC-030: 최악의 RNG (크리티컬 0%, 멀티히트 0%)
```
테스트 목표:
- 확률 보너스 없이도 클리어 가능 여부

시나리오:
- crit_chance: 0% (투자 안 함)
- multi_hit: 0% (투자 안 함)
- 순수 기본 데미지로만 플레이

검증 방법:
클리어 가능 레벨 측정

합격 기준:
- 레벨 30 이상 클리어 가능
- 세션 시간 20분 이내
```

#### TC-031: 최상의 RNG (풀 투자)
```
테스트 목표:
- 모든 확률 스탯 MAX 시 밸런스 붕괴 여부

시나리오:
- crit_chance: 50% (Lv50)
- crit_damage: ×5 (Lv30)
- multi_hit: 30% (Lv30)

기대 평균 데미지:
- 기본: 100
- 크리티컬 50%: 100 × (1 + 0.5 × 4) = 300
- 멀티히트 30%: 300 × (1 + 0.3 × 1) = 390
- 최종: 390 DPS

검증 방법:
레벨 100 도달 시간 측정

합격 기준:
- 레벨 100 도달: 20분 이상 소요 (속도런 방지)
```

---

### 5.5 자동화 테스트 스크립트

#### 테스트 실행 명령
```bash
# 전체 밸런스 분석 (문서 자동 생성)
dotnet run --project DeskWarrior.Simulator -- --analyze --target 50 --crystals 1000 --output balanceDoc/report

# 진행도 시뮬레이션
dotnet run --project DeskWarrior.Simulator -- --progress --target 100 --strategy greedy

# 디버그 모드 (단계별 확인)
dotnet run --project DeskWarrior.Simulator -- --debug

# 배치 시뮬레이션
dotnet run --project DeskWarrior.Simulator -- --target 50 --runs 10000 --cps 5
```

#### 자동 검증 기준
```python
# tools/balance_test_config.json
{
  "tc001_first_play": {
    "target_level": 15,
    "target_crystal": 10,
    "max_time_minutes": 10,
    "tolerance": 0.2  # ±20% 허용
  },
  "tc010_gold_economy": {
    "level_20_gold": 1500,
    "upgrade_coverage": 0.7,  # 70% 비용 커버
    "remaining_gold_ratio": [0, 0.3]
  }
}
```

---

## 6. 밸런스 조정 가이드

### 6.1 문제 진단 플로우차트

```
[사용자 피드백]
    |
    v
"너무 어렵다" → GPM < 100? → YES → base_cost ↓ 20%
                            → NO  → monster_hp ↓ 10%
    |
    v
"너무 쉽다" → 레벨 50 < 30분? → YES → growth_rate ↑ 0.2
                              → NO  → multiplier ↑ 0.1
    |
    v
"성장 체감 없음" → ROI > 10회? → YES → effect_per_level ↑ 50%
                               → NO  → crystal_drop ↑ 20%
```

---

### 6.2 핫픽스 파라미터

#### 즉시 조정 가능 항목 (config/*.json 수정만)
```json
{
  "hotfix_parameters": {
    "global_gold_multiplier": 1.0,
    "global_crystal_multiplier": 1.0,
    "monster_hp_multiplier": 1.0,
    "base_time_limit": 60
  }
}
```

#### 조정 시나리오별 대응
| 문제 | 핫픽스 | 예상 효과 |
|------|--------|----------|
| 초반 너무 어려움 | global_gold_multiplier = 1.5 | GPM +50% |
| 후반 너무 쉬움 | monster_hp_multiplier = 1.3 | 체감 난이도 +30% |
| 크리스탈 부족 | global_crystal_multiplier = 1.2 | 성장 속도 +20% |

---

### 6.3 A/B 테스트 프레임워크

#### 테스트 그룹 분할
```python
# 50% 유저: 기본 밸런스
# 50% 유저: 실험 밸런스

if user_id % 2 == 0:
    config = load_config("InGameStatGrowth_experimental.json")
else:
    config = load_config("InGameStatGrowth.json")
```

#### 추적 메트릭
```python
metrics_to_track = {
    "avg_session_time": float,
    "avg_level_reached": int,
    "crystal_per_session": int,
    "retention_rate_7d": float,
    "nps_score": int  # Net Promoter Score
}
```

---

## 7. 장기 업데이트 로드맵

### 7.1 Phase 1: 코어 밸런스 안정화 (v1.0-1.2)
- [ ] TC-001 ~ TC-011 모든 테스트 통과
- [ ] 초보자 10회 플레이 리텐션 60% 이상
- [ ] 평균 세션 시간 12분 ± 3분

### 7.2 Phase 2: 콤보 시스템 정교화 (v1.3-1.5)
- [ ] 콤보 시각 피드백 강화
- [ ] combo_flex 단계별 체감 차이 검증
- [ ] 상급자용 "Perfect Combo" 보너스 추가

### 7.3 Phase 3: 메타 게임 확장 (v2.0)
- [ ] 새로운 영구 스탯 5종 추가
- [ ] 프리셋 빌드 시스템
- [ ] 리더보드 및 챌린지 모드

---

## 8. 참고 자료

### 8.1 관련 문서
- `docs/STAT_SYSTEM.md`: 스탯 시스템 전체 설계
- `config/InGameStatGrowth.json`: 인게임 스탯 파라미터
- `config/PermanentStats.json`: 영구 스탯 파라미터 (통합 데이터)
- `DeskWarrior.Simulator/`: 공식 밸런스 시뮬레이터 (C# .NET)
- `balance_dashboard_qt.py`: 대화형 밸런스 대시보드 (Python GUI)

### 8.2 외부 레퍼런스
- **Cookie Clicker**: 지수 성장 곡선 모델
- **Path of Exile**: 복합 스탯 시너지 설계
- **Vampire Survivors**: 세션 기반 성장 밸런스

### 8.3 데이터 시트
- **밸런스 시뮬레이션 결과**: `DeskWarrior.Simulator/balanceDoc/` (자동 생성 보고서)
- **분석 히스토리**: `DeskWarrior.Simulator/balanceDoc/analysis_history.json`
- **사용자 플레이 로그**: (향후 구현 예정)

---

## 변경 이력
- **v1.0 (2026-01-16)**: 초안 작성 (jina)
  - 플레이 진행도 예측 정량화
  - 경제 밸런스 모델 수립
  - 콤보 시스템 상세 설계
  - 테스트 시나리오 정의

---

**문서 상태**: 검토 대기
**다음 작업**: 자동화 테스트 스크립트 구현 (`tools/balance_test_suite.py`)
**담당자**: lily (Implementation Lead)
