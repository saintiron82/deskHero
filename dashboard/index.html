<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeskWarrior Balance Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="js/lib/chart.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>DeskWarrior Balance Dashboard</h1>
            <p class="subtitle">Game Balance Analysis & Visualization Tool</p>
            <div id="save-indicator" class="save-indicator"></div>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="stat-growth">Stat Growth</button>
            <button class="tab-btn" data-tab="dps-simulator">DPS Simulator</button>
            <button class="tab-btn" data-tab="session-predictor">Session Predictor</button>
            <button class="tab-btn" data-tab="balance-analyzer">Balance Analysis</button>
        </nav>

        <main class="tab-content">
            <!-- Tab 1: Stat Growth -->
            <section id="stat-growth" class="tab-panel active">
                <div class="panel-grid">
                    <aside class="control-panel">
                        <h3>Stat Selection</h3>
                        <div class="stat-category" id="permanent-stats">
                            <h4>Permanent Stats</h4>
                            <div id="permanent-stat-checkboxes"></div>
                        </div>
                        <div class="stat-category" id="ingame-stats">
                            <h4>In-Game Stats</h4>
                            <div id="ingame-stat-checkboxes"></div>
                        </div>
                        <div class="control-group">
                            <label>Level Range</label>
                            <div class="range-inputs">
                                <input type="number" id="level-min" value="1" min="1" max="200">
                                <span>~</span>
                                <input type="number" id="level-max" value="50" min="1" max="200">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Display Options</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="show-cost" checked> Upgrade Cost</label>
                                <label><input type="checkbox" id="show-cumulative" checked> Cumulative Cost</label>
                                <label><input type="checkbox" id="show-effect" checked> Effect</label>
                            </div>
                        </div>
                        <button class="btn-primary" id="update-growth-chart">Update Chart</button>
                    </aside>
                    <div class="chart-area">
                        <div class="chart-container">
                            <canvas id="growth-chart"></canvas>
                        </div>
                        <div class="milestone-table-container">
                            <h3>Milestone Summary</h3>
                            <table id="milestone-table" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Stat</th>
                                        <th>Lv 10</th>
                                        <th>Lv 25</th>
                                        <th>Lv 50</th>
                                        <th>Lv 100</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 2: DPS Simulator -->
            <section id="dps-simulator" class="tab-panel">
                <div class="panel-grid">
                    <aside class="control-panel">
                        <h3>Stat Input</h3>
                        <div class="stat-input-group">
                            <h4>Base Stats</h4>
                            <label>Base Power <input type="number" id="base-power" value="10"></label>
                            <label>Base Attack <input type="number" id="base-attack" value="0"></label>
                            <label>Attack % <input type="number" id="attack-percent" value="0" step="0.01"></label>
                        </div>
                        <div class="stat-input-group">
                            <h4>Critical</h4>
                            <label>Crit Chance % <input type="number" id="crit-chance" value="10" step="1"></label>
                            <label>Crit Multiplier <input type="number" id="crit-damage" value="2.0" step="0.1"></label>
                        </div>
                        <div class="stat-input-group">
                            <h4>Multi-Hit</h4>
                            <label>Multi-Hit Chance % <input type="number" id="multi-hit-chance" value="0" step="1"></label>
                        </div>
                        <div class="stat-input-group">
                            <h4>Combo</h4>
                            <label>Combo Stack
                                <select id="combo-stack">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </label>
                            <label>Combo Damage % <input type="number" id="combo-damage" value="0"></label>
                        </div>
                        <button class="btn-primary" id="calculate-damage">Calculate</button>
                    </aside>
                    <div class="chart-area">
                        <div class="result-cards">
                            <div class="result-card">
                                <span class="card-label">Final Damage</span>
                                <span class="card-value" id="final-damage">0</span>
                            </div>
                            <div class="result-card">
                                <span class="card-label">Expected DPS</span>
                                <span class="card-value" id="expected-dps">0</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="damage-breakdown-chart"></canvas>
                        </div>
                        <div class="damage-steps">
                            <h3>Damage Calculation Steps</h3>
                            <div id="damage-steps-list"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 3: Session Predictor -->
            <section id="session-predictor" class="tab-panel">
                <div class="panel-grid">
                    <aside class="control-panel">
                        <h3>Simulation Settings</h3>
                        <div class="control-group">
                            <label>Number of Sessions <input type="number" id="num-sessions" value="10" min="1" max="100"></label>
                            <label>Average Level per Session <input type="number" id="avg-level" value="20" min="1" max="200"></label>
                        </div>
                        <div class="control-group">
                            <label>Investment Strategy</label>
                            <div class="radio-group">
                                <label><input type="radio" name="strategy" value="damage" checked> Damage Focus</label>
                                <label><input type="radio" name="strategy" value="economy"> Economy Focus</label>
                                <label><input type="radio" name="strategy" value="hybrid"> Hybrid</label>
                            </div>
                        </div>
                        <button class="btn-primary" id="run-simulation">Run Simulation</button>
                    </aside>
                    <div class="chart-area">
                        <div class="chart-container">
                            <canvas id="session-progress-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="stat-level-chart"></canvas>
                        </div>
                        <div class="session-table-container">
                            <h3>Session Details</h3>
                            <table id="session-table" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Session</th>
                                        <th>Level</th>
                                        <th>Crystals</th>
                                        <th>Total Crystals</th>
                                        <th>Upgrades</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 4: Balance Analyzer -->
            <section id="balance-analyzer" class="tab-panel">
                <div class="panel-grid">
                    <aside class="control-panel">
                        <h3>Analysis Settings</h3>
                        <div class="control-group">
                            <label>Target Level <input type="number" id="analysis-level" value="10" min="1" max="100"></label>
                        </div>
                        <div class="control-group">
                            <label>Category Filter</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" class="category-filter" value="base" checked> Base</label>
                                <label><input type="checkbox" class="category-filter" value="currency" checked> Currency</label>
                                <label><input type="checkbox" class="category-filter" value="utility" checked> Utility</label>
                                <label><input type="checkbox" class="category-filter" value="starting" checked> Starting</label>
                            </div>
                        </div>
                        <button class="btn-primary" id="run-analysis">Analyze</button>
                    </aside>
                    <div class="chart-area">
                        <div class="chart-row">
                            <div class="chart-container half">
                                <h3>Cost Efficiency (Effect / Cost)</h3>
                                <canvas id="efficiency-chart"></canvas>
                            </div>
                            <div class="chart-container half">
                                <h3>Cost vs Effect</h3>
                                <canvas id="scatter-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h3>Build Comparison (Radar)</h3>
                            <canvas id="radar-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="dashboard-footer">
            <p>DeskWarrior Balance Dashboard v1.0 | Data from StatFormulas.json</p>
        </footer>
    </div>

    <!-- Stat Edit Modal -->
    <div id="stat-edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-stat-name">Edit Stat</h2>
                <button class="modal-close" onclick="StatEditor.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stat-edit-form">
                    <input type="hidden" id="edit-stat-id">
                    <input type="hidden" id="edit-stat-type">

                    <div class="form-group">
                        <label for="edit-name">Name</label>
                        <input type="text" id="edit-name" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-base-cost">Base Cost</label>
                            <input type="number" id="edit-base-cost" step="1" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-growth-rate">Growth Rate</label>
                            <input type="number" id="edit-growth-rate" step="0.01" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-multiplier">Multiplier</label>
                            <input type="number" id="edit-multiplier" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-softcap">Softcap Interval</label>
                            <input type="number" id="edit-softcap" step="1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-effect">Effect per Level</label>
                            <input type="number" id="edit-effect" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-max-level">Max Level (0=no limit)</label>
                            <input type="number" id="edit-max-level" step="1" value="0">
                        </div>
                    </div>

                    <div class="form-preview">
                        <h4>Cost Preview</h4>
                        <div id="cost-preview-table"></div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="StatEditor.closeModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config-loader.js"></script>
    <script src="js/formula-engine.js"></script>
    <script src="js/chart-utils.js"></script>
    <script src="js/tabs/stat-growth.js"></script>
    <script src="js/tabs/dps-simulator.js"></script>
    <script src="js/tabs/session-predictor.js"></script>
    <script src="js/tabs/balance-analyzer.js"></script>
    <script src="js/stat-editor.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
